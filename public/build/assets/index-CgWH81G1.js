import{r,S as H,j as e,L as se}from"./app-DbpzdwFL.js";import{A as ae,b as te,c as re,d as ie,e as ne,f as le,g as oe,h as ce}from"./alert-dialog-CdPscUwQ.js";import{B as h}from"./button-nsSqORs2.js";import{D as de,b as me,g as ue,c as xe,d as he,e as ge}from"./dialog-CupH4Hmp.js";import{P as K}from"./progress-Bl6rcoQv.js";import{t as f,T as pe}from"./index-adnqAMSx.js";import{A as fe}from"./arrow-left-fki0sEH7.js";import{C as O}from"./clock-JumJjszk.js";import{c as q}from"./createLucideIcon-C4hA1fDf.js";/* empty css            */import"./index-DLFvmWB3.js";import"./index-BNGjsBO4.js";import"./index-muyUwSbg.js";import"./Combination-BfBk5v_5.js";import"./utils-t30SwFLs.js";import"./index-BKZ60sTg.js";import"./x-Ck5JSsba.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M6 8L2 12L6 16",key:"kyvwex"}],["path",{d:"M2 12H22",key:"1m8cig"}]],be=q("MoveLeft",je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],ve=q("MoveRight",Ne);function Ke({quiz:t,attempt:C,user:P}){const g=`quiz_${t.id}_${C.id}_${P.id}`,j=`${g}_timer`,[o,v]=r.useState(0),[p,$]=r.useState({}),[k,y]=r.useState(0),[l,A]=r.useState(!0),[Q,I]=r.useState(!1),[R,w]=r.useState(!1),[b,_]=r.useState(!0),[c,M]=r.useState(!1),d=r.useRef(null),m=r.useRef(!1),S=r.useCallback(s=>{const a={timeLeft:s,timestamp:Date.now()};localStorage.setItem(j,JSON.stringify(a))},[j]),D=r.useCallback(()=>{localStorage.removeItem(g),localStorage.removeItem(j)},[g,j]),Y=s=>{const a=Math.floor(s/60),n=s%60;return`${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},J=(s,a)=>{$(n=>({...n,[s]:a}))},G=s=>{v(s)},W=()=>{o<t.questions.length-1&&v(o+1)},U=()=>{o>0&&v(o-1)},u=()=>Object.keys(p).length,z=()=>{I(!0)},V=()=>{D(),d.current&&clearInterval(d.current),H.delete(`/quiz/${t.id}/cancel`)},T=r.useCallback(()=>{if(!m.current){m.current=!0;try{d.current&&clearInterval(d.current);const s=Object.entries(p).map(([a,n])=>({question_id:a,selected_option_id:n}));H.post(`/quiz/${t.id}/submit`,{attempt_id:C.id,answers:s},{onSuccess:()=>{f.success("Quiz berhasil dikumpulkan!"),D()},onError:a=>{console.error("Failed to submit quiz:",a),f.error("Gagal mengumpulkan quiz"),m.current=!1},onFinish:()=>{m.current=!1}})}catch(s){console.error("Failed to prepare submission:",s),f.error("Gagal memproses jawaban"),m.current=!1}}},[p,t.id,C.id,D,d]),B=r.useCallback(()=>{m.current||T()},[T]),E=()=>{const s=u();if(s<t.questions.length){f.error("Belum Lengkap!",{description:`Anda baru mengerjakan ${s} dari ${t.questions.length} soal. Harap lengkapi semua soal terlebih dahulu.`});return}w(!0)},X=()=>{w(!1),T()};r.useEffect(()=>{(()=>{try{const a=localStorage.getItem(g);if(a){const{answers:x,currentQuestionIndex:N}=JSON.parse(a);$(x||{}),v(N||0),f.success("Data quiz sebelumnya berhasil dipulihkan")}if(t.time_limit===0){A(!1),y(0),_(!1);return}A(!0);const n=localStorage.getItem(j);if(n){const{timeLeft:x,timestamp:N}=JSON.parse(n),Z=Date.now(),ee=Math.floor((Z-N)/1e3),F=Math.max(0,x-ee);y(F),F<=0&&M(!0)}else{const x=t.time_limit*60;y(x),S(x)}_(!1)}catch(a){console.error("Failed to initialize quiz:",a),f.error("Gagal memuat data quiz"),_(!1)}})()},[t.id,t.time_limit,S,g,j]),r.useEffect(()=>{if(!b){const s={answers:p,currentQuestionIndex:o,timestamp:Date.now()};localStorage.setItem(g,JSON.stringify(s))}},[p,o,g,b]),r.useEffect(()=>{if(!(!l||b||c||m.current))return d.current=setInterval(()=>{y(s=>{const a=s-1;return S(a),a<=0?(M(!0),d.current&&clearInterval(d.current),0):a})},1e3),()=>{d.current&&clearInterval(d.current)}},[l,b,c,S]),r.useEffect(()=>{l&&c&&!m.current&&(f.error("Waktu habis! Quiz akan dikumpulkan otomatis."),B())},[l,c,B]);const L=u()/t.questions.length*100,i=t.questions[o];return b?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-32 w-32 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data quiz..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{title:`${t.title}`}),e.jsx("header",{className:"fixed top-0 right-0 left-0 z-50 border-b bg-white/95 shadow-sm backdrop-blur-sm",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(h,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:z,children:[e.jsx(fe,{className:"h-4 w-4"}),"Kembali"]}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:t.title})]}),l?e.jsxs("div",{className:`flex items-center gap-2 rounded-full border px-3 py-1 text-sm ${k<300?"border-red-200 bg-red-50 text-red-800":"border-primary-foreground bg-gray-50 text-gray-800"}`,children:[e.jsx(O,{className:`h-5 w-5 ${k<300?"text-red-500":"text-orange-500"}`}),e.jsx("span",{className:`text-lg font-semibold ${k<300?"text-red-600":"text-gray-900"}`,children:Y(k)})]}):e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-sm",children:[e.jsx(O,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Tanpa Batas Waktu"})]}),e.jsxs("div",{className:"hidden items-center gap-4 md:flex",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[u(),"/",t.questions.length," dikerjakan"]}),e.jsx(K,{value:L,className:"h-2 w-32 rounded-md"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between md:hidden",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[u(),"/",t.questions.length," soal dikerjakan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{value:L,className:"h-2 w-20"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(L),"%"]})]})]})]})}),e.jsx("div",{className:"min-h-screen bg-gradient-to-tr from-[#E5EDE3] to-[#F6F0E2]",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 pt-30 pb-8 md:pt-24",children:e.jsxs("div",{className:"grid grid-cols-1 gap-12 lg:grid-cols-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"rounded-lg border bg-white shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b pb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 md:text-lg",children:["Soal No. ",o+1]}),e.jsx("span",{className:"rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-800",children:(i==null?void 0:i.type)==="multiple_choice"?"Pilihan Ganda":"Benar/Salah"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:(i==null?void 0:i.question_text)||""}})}),(i==null?void 0:i.question_image)&&e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:i.question_image,alt:"Question",className:"max-h-96 w-full rounded-lg border object-contain shadow-sm"})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-gray-700",children:"Pilih Jawaban:"}),e.jsx("div",{className:"space-y-3",children:i==null?void 0:i.options.map((s,a)=>{const n=p[i.id]===s.id,x=s.option_text&&s.option_text.trim()!=="",N=s.option_image;return e.jsx("label",{className:`flex cursor-pointer flex-col gap-3 rounded-lg border-2 p-4 transition-all ${n?"border-primary bg-primary/10 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"} ${l&&c?"cursor-not-allowed opacity-50":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:`question-${i.id}`,value:s.id,checked:n,onChange:()=>J(i.id,s.id),className:"text-primary focus:ring-primary mt-1 h-4 w-4 flex-shrink-0 focus:ring-2",disabled:l&&c}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"flex-shrink-0 font-semibold text-gray-700",children:[String.fromCharCode(65+a),"."]}),x&&e.jsx("div",{className:`prose prose-sm max-w-none ${n?"font-medium text-gray-900":"text-gray-800"}`,dangerouslySetInnerHTML:{__html:s.option_text}})]}),N&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:s.option_image||"",alt:`Opsi ${String.fromCharCode(65+a)}`,className:"max-h-48 rounded-md border object-contain shadow-sm"})})]}),n&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary flex h-6 w-6 items-center justify-center rounded-full text-white",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})})]})},s.id)})})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs(h,{onClick:U,disabled:o===0||l&&c,variant:"outline",className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"})," Sebelumnya"]}),o===t.questions.length-1&&u()===t.questions.length?e.jsx(h,{onClick:E,disabled:l&&c,className:"gap-2",children:"Kumpulkan ðŸš€"}):e.jsxs(h,{onClick:W,disabled:o===t.questions.length-1||l&&c,className:"gap-2",children:["Selanjutnya ",e.jsx(ve,{className:"h-4 w-4"})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"border-primary-foreground bg-accent/80 sticky top-24 rounded-lg border shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"mb-4 text-base font-semibold md:text-lg",children:"Nomor Soal"}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-2",children:Array.from({length:t.questions.length},(s,a)=>{var n;return e.jsx(h,{onClick:()=>G(a),disabled:l&&c,className:`h-10 w-10 rounded text-sm font-medium transition-colors ${p[(n=t.questions[a])==null?void 0:n.id]!==void 0?"bg-primary hover:bg-primary text-white":a===o?"bg-blue-300 text-gray-700 hover:bg-blue-400 hover:text-gray-700":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-700"}`,children:a+1},a)})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-gray-200"}),e.jsx("span",{children:"Belum Dikerjakan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary h-4 w-4 rounded"}),e.jsx("span",{children:"Sudah Dikerjakan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 rounded bg-blue-300"}),e.jsx("span",{children:"Nomor Soal Saat Ini"})]})]}),e.jsx(h,{className:"mt-6 w-full",onClick:E,disabled:l&&c,children:l&&c?"Waktu Habis":"Kumpulkan"})]})})})]})})}),e.jsx(ae,{open:Q,onOpenChange:I,children:e.jsxs(te,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Konfirmasi Keluar"}),e.jsx(ne,{children:u()>0?"Yakin ingin keluar? Semua progress dan jawaban akan hilang dan tidak dapat dipulihkan.":"Yakin ingin keluar dari quiz?"})]}),e.jsxs(le,{children:[e.jsx(oe,{children:"Batal"}),e.jsx(ce,{onClick:V,children:"Ya, Keluar"})]})]})}),e.jsx(de,{open:R,onOpenChange:w,children:e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Siap Dikumpulkan!"}),e.jsx(he,{children:u()===t.questions.length?"Semua soal sudah dijawab. Yakin ingin mengumpulkan quiz?":`Anda baru mengerjakan ${u()} dari ${t.questions.length} soal. Yakin ingin mengumpulkan quiz sekarang?`})]}),e.jsxs(ge,{children:[e.jsx(h,{variant:"outline",onClick:()=>w(!1),children:"Batal"}),e.jsx(h,{onClick:X,children:"Ya, Kumpulkan"})]})]})}),e.jsx(pe,{position:"top-center",richColors:!0})]})}export{Ke as default};
