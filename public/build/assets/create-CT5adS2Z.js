import{r as f,j as e,L as ie,S as le}from"./app-DDrbOcx7.js";import{B as oe}from"./badge-DPaCgwXx.js";import{B as b}from"./button-n6t9aljh.js";import{C as R}from"./calendar-BhhslL_H.js";import{C as w}from"./checkbox-DJcK8sHB.js";import{u as ce,F as de,a as c,b as d,c as n,d as m,f as j,e as u}from"./form-Bms38uoL.js";import{I as k}from"./input-Cyw6XLMS.js";import{P as T,a as D,b as M}from"./popover-BpDeC2Pf.js";import{S as z,a as J,b as U,c as W,d as v}from"./select-VRNrCGIM.js";import{T as me}from"./textarea-cAIiDN97.js";import{A as pe}from"./admin-layout-C0cg0-Ls.js";import{c as $}from"./utils-iBm1Tl-X.js";import{s as ue,o as q,c as Y,d as he,f as X,n as y,e as xe,b as h}from"./types-BVLPpEpw.js";import{p as K}from"./parseISO-CfmKIOEe.js";import{T as je}from"./tag-j4koJliQ.js";import{S as ge}from"./shuffle-BYZ1dKO4.js";import{P as fe}from"./percent-qLEcjqf2.js";import{C as G}from"./calendar-CsOO3jmI.js";import{C as H}from"./chevron-down-G_uyAGbz.js";import{C as be}from"./circle-alert-C6e7ebLX.js";import{P as ke}from"./plus-DeQYL3Ck.js";import{X as ye}from"./x-CwuwPgbl.js";import{f as F}from"./format-CNjBDjOL.js";import{i as A}from"./id-BLKIQCr7.js";import"./index-C8yCsOo4.js";import"./index-CoQoLWu2.js";import"./chevron-left-CFki6ZZN.js";import"./createLucideIcon-C_qgjRbq.js";import"./chevron-right-BV7D4beh.js";import"./index-nY49zWbg.js";import"./index-CcfFFHDG.js";import"./index-D6HRdG18.js";import"./index-F3JIwsXn.js";import"./index-C3inlMtn.js";import"./index-DtQ_Rnnk.js";import"./check-NWeBrsRy.js";import"./label-D-uUvZd6.js";import"./floating-ui.react-dom-D8FI13iJ.js";import"./Combination-CnK2SSZv.js";import"./index-Ddlkc-n2.js";import"./index-BHF_HL52.js";import"./index-D48N0srj.js";import"./chevron-up-rNT23ciB.js";import"./sonner-DCv2eaTX.js";import"./index-D3iUQMMW.js";import"./breadcrumbs-jHUHouR0.js";import"./index-Db4ZopbB.js";import"./tooltip-u_ljFAmM.js";import"./dropdown-menu-lbd9n5hY.js";import"./avatar-CkXFm7ID.js";import"./use-initials-DNyhZYBR.js";import"./user-DQ_7ooaZ.js";import"./app-sidebar-header-k4GOENYt.js";import"./chevrons-up-down-DnoUVkkH.js";import"./user-check-CJ7u2eMG.js";import"./users-BJxXLrnZ.js";import"./presentation-BHuumwn-.js";import"./gift-B_UnLwMS.js";import"./banknote-CGWBhV_P.js";import"./dollar-sign-CZnYDmsC.js";import"./file-text-WH-W2CNB.js";const Ne=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Kode Diskon",href:"/admin/discount-codes"},{title:"Tambah Kode Diskon",href:"/admin/discount-codes/create"}],ve=q({code:h().min(1,"Kode diskon harus diisi").max(50,"Kode diskon maksimal 50 karakter"),name:h().min(1,"Nama diskon harus diisi").max(255,"Nama diskon maksimal 255 karakter"),description:h().optional(),type:xe(["percentage","fixed"],{required_error:"Jenis diskon harus dipilih"}),value:y().min(1,"Nilai diskon harus lebih dari 0"),minimum_amount:y().optional(),usage_limit:y().optional(),usage_limit_per_user:y().optional(),starts_at:X({required_error:"Tanggal mulai harus dipilih"}),expires_at:X({required_error:"Tanggal berakhir harus dipilih"}),is_active:he(),applicable_types:Y(h()).optional(),applicable_products:Y(q({type:h(),id:h(),title:h(),price:y(),registration_end:h().optional(),start_date:h().optional(),event_date:h().optional(),batch:y().optional()})).optional()}).refine(p=>!(p.type==="percentage"&&p.value>100),{message:"Persentase tidak boleh lebih dari 100%",path:["value"]}).refine(p=>p.expires_at>p.starts_at,{message:"Tanggal berakhir harus setelah tanggal mulai",path:["expires_at"]});function Ma({products:p}){const[Q,O]=f.useState(!1),[Z,B]=f.useState(!1),[ee,I]=f.useState(!1),[o,C]=f.useState("course"),r=ce({resolver:ue(ve),defaultValues:{code:"",name:"",description:"",type:"percentage",value:10,minimum_amount:void 0,usage_limit:void 0,usage_limit_per_user:void 0,starts_at:new Date,expires_at:new Date(Date.now()+30*24*60*60*1e3),is_active:!0,applicable_types:[],applicable_products:[]}}),_=r.watch("type"),l=r.watch("applicable_types")||[],V=r.watch("applicable_products"),x=f.useMemo(()=>V||[],[V]),P=r.watch("starts_at"),ae=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let s="";for(let t=0;t<8;t++)s+=a.charAt(Math.floor(Math.random()*a.length));r.setValue("code",s)},S=(a,s)=>{const t=l;if(s){const i=[...t,a];r.setValue("applicable_types",i),i.length===1&&C(a)}else{const i=t.filter(g=>g!==a);r.setValue("applicable_types",i);const N=x.filter(g=>g.type!==a);r.setValue("applicable_products",N),o===a&&i.length>0&&C(i[0])}},se=(a,s)=>{const t={...a,type:s,registration_deadline:a.registration_deadline,start_date:a.start_date,event_date:a.event_date,batch:a.batch},i=x;i.some(g=>g.id===a.id&&g.type===s)||r.setValue("applicable_products",[...i,t]),I(!1)},te=a=>{const s=x.filter(t=>!(t.id===a.id&&t.type===a.type));r.setValue("applicable_products",s)},E=f.useMemo(()=>{const a=P,s=x.filter(t=>t.type===o).map(t=>t.id);switch(o){case"course":return p.courses.filter(t=>!s.includes(t.id));case"bootcamp":return p.bootcamps.filter(t=>s.includes(t.id)?!1:!t.registration_deadline||!a?!0:K(t.registration_deadline)>=a);case"webinar":return p.webinars.filter(t=>s.includes(t.id)?!1:!t.registration_deadline||!a?!0:K(t.registration_deadline)>=a);default:return[]}},[o,p,P,x]),L=a=>{switch(a){case"course":return"Kelas";case"bootcamp":return"Bootcamp";case"webinar":return"Webinar";default:return a}},re=(a,s)=>{if(s==="course"||!a.registration_deadline)return null;const t=K(a.registration_deadline),i=new Date,N=P;return t<i?{type:"closed",text:"Pendaftaran ditutup"}:N&&t<N?{type:"will-close",text:"Akan tutup sebelum diskon aktif"}:{type:"open",text:`Tutup: ${F(t,"dd MMM yyyy",{locale:A})}`}};function ne(a){const s={...a,description:a.description||null,minimum_amount:a.minimum_amount||null,usage_limit:a.usage_limit||null,usage_limit_per_user:a.usage_limit_per_user||null,applicable_types:a.applicable_types&&a.applicable_types.length>0?a.applicable_types:null,applicable_products:a.applicable_products&&a.applicable_products.length>0?a.applicable_products:null,starts_at:a.starts_at.toISOString(),expires_at:a.expires_at.toISOString()};le.post(route("discount-codes.store"),s)}return e.jsxs(pe,{breadcrumbs:Ne,children:[e.jsx(ie,{title:"Tambah Kode Diskon"}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Tambah Kode Diskon"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:"Silakan isi form di bawah ini untuk membuat kode diskon baru. Pastikan semua informasi yang diperlukan telah diisi dengan benar."}),e.jsx(de,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ne),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Dasar"})]}),e.jsx(c,{control:r.control,name:"code",render:({field:a})=>e.jsxs(d,{children:[e.jsxs(n,{children:["Kode Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{children:e.jsx(k,{placeholder:"DISKON2024",...a,onChange:s=>a.onChange(s.target.value.toUpperCase()),className:"font-mono",autoComplete:"off"})}),e.jsx(b,{type:"button",variant:"outline",onClick:ae,children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsx(j,{children:"Kode unik untuk diskon ini (akan otomatis menjadi huruf besar)"}),e.jsx(u,{})]})}),e.jsx(c,{control:r.control,name:"name",render:({field:a})=>e.jsxs(d,{children:[e.jsxs(n,{children:["Nama Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{children:e.jsx(k,{placeholder:"Diskon Tahun Baru",...a,autoComplete:"off"})}),e.jsx(u,{})]})}),e.jsx(c,{control:r.control,name:"description",render:({field:a})=>e.jsxs(d,{children:[e.jsx(n,{children:"Deskripsi"}),e.jsx(m,{children:e.jsx(me,{placeholder:"Deskripsi kode diskon...",...a,value:a.value||"",autoComplete:"off",rows:3})}),e.jsx(u,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(c,{control:r.control,name:"type",render:({field:a})=>e.jsxs(d,{children:[e.jsxs(n,{children:["Jenis Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(z,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(U,{placeholder:"Pilih jenis diskon"})})}),e.jsxs(W,{children:[e.jsx(v,{value:"percentage",children:"Persentase (%)"}),e.jsx(v,{value:"fixed",children:"Nominal (Rp)"})]})]}),e.jsx(u,{})]})}),e.jsx(c,{control:r.control,name:"value",render:({field:a})=>e.jsxs(d,{children:[e.jsxs(n,{children:["Nilai ",_==="percentage"?"Persentase":"Nominal"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{children:e.jsx(k,{type:"number",placeholder:_==="percentage"?"10":"50000",...a,onChange:s=>a.onChange(Number(s.target.value)),min:"1",max:_==="percentage"?100:void 0})}),e.jsx(j,{children:_==="percentage"?"Masukkan nilai 1-100":"Masukkan nominal dalam Rupiah"}),e.jsx(u,{})]})})]}),e.jsx(c,{control:r.control,name:"minimum_amount",render:({field:a})=>e.jsxs(d,{children:[e.jsx(n,{children:"Minimum Pembelian"}),e.jsx(m,{children:e.jsx(k,{type:"number",placeholder:"100000",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"0"})}),e.jsx(j,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:16}),e.jsx("h3",{className:"font-medium",children:"Penggunaan & Validitas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"usage_limit",render:({field:a})=>e.jsxs(d,{children:[e.jsx(n,{children:"Batas Penggunaan Total"}),e.jsx(m,{children:e.jsx(k,{type:"number",placeholder:"100",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"1"})}),e.jsx(j,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})}),e.jsx(c,{control:r.control,name:"usage_limit_per_user",render:({field:a})=>e.jsxs(d,{children:[e.jsx(n,{children:"Batas Per User"}),e.jsx(m,{children:e.jsx(k,{type:"number",placeholder:"1",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"1"})}),e.jsx(j,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"starts_at",render:({field:a})=>e.jsxs(d,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(T,{open:Q,onOpenChange:O,children:[e.jsx(D,{asChild:!0,children:e.jsx(m,{children:e.jsxs(b,{variant:"outline",className:$("justify-between text-left font-normal",!a.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),a.value?F(a.value,"dd MMM yyyy",{locale:A}):"Pilih tanggal"]}),e.jsx(H,{className:"h-4 w-4"})]})})}),e.jsx(M,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(R,{mode:"single",selected:a.value,captionLayout:"dropdown",endMonth:new Date(new Date().getFullYear()+10,11),onSelect:s=>{s&&a.onChange(s),O(!1)},disabled:s=>s<new Date,initialFocus:!0})})]}),e.jsx(j,{children:"Produk bootcamp dan webinar akan difilter berdasarkan tanggal ini"}),e.jsx(u,{})]})}),e.jsx(c,{control:r.control,name:"expires_at",render:({field:a})=>e.jsxs(d,{className:"flex flex-col",children:[e.jsxs(n,{children:["Tanggal Berakhir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(T,{open:Z,onOpenChange:B,children:[e.jsx(D,{asChild:!0,children:e.jsx(m,{children:e.jsxs(b,{variant:"outline",className:$("justify-between text-left font-normal",!a.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),a.value?F(a.value,"dd MMM yyyy",{locale:A}):"Pilih tanggal"]}),e.jsx(H,{className:"h-4 w-4"})]})})}),e.jsx(M,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(R,{mode:"single",selected:a.value,captionLayout:"dropdown",endMonth:new Date(new Date().getFullYear()+10,11),onSelect:s=>{s&&a.onChange(s),B(!1)},disabled:s=>s<r.getValues("starts_at"),initialFocus:!0})})]}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Berlaku Untuk Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"course",checked:l.includes("course"),onCheckedChange:a=>S("course",!!a)}),e.jsx(n,{htmlFor:"course",className:"text-sm font-normal",children:"Kelas Online"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"bootcamp",checked:l.includes("bootcamp"),onCheckedChange:a=>S("bootcamp",!!a)}),e.jsx(n,{htmlFor:"bootcamp",className:"text-sm font-normal",children:"Bootcamp"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"webinar",checked:l.includes("webinar"),onCheckedChange:a=>S("webinar",!!a)}),e.jsx(n,{htmlFor:"webinar",className:"text-sm font-normal",children:"Webinar"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kosong = berlaku untuk semua produk"}),(l.includes("bootcamp")||l.includes("webinar"))&&e.jsx("div",{className:"rounded-md bg-blue-50 p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(be,{className:"mt-0.5 mr-2 h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-800",children:"Catatan:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Bootcamp dan webinar yang dapat dipilih hanya yang pendaftarannya masih berlaku setelah tanggal mulai diskon."})]})]})})]}),l.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Produk Spesifik (Opsional)"}),e.jsxs(T,{open:ee,onOpenChange:I,children:[e.jsx(D,{asChild:!0,children:e.jsxs(b,{type:"button",variant:"outline",size:"sm",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Tambah Produk"]})}),e.jsx(M,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Jenis Produk"}),e.jsxs(z,{value:o,onValueChange:C,defaultValue:l.length>0?l[0]:"course",children:[e.jsx(J,{children:e.jsx(U,{placeholder:"Pilih jenis produk"})}),e.jsxs(W,{children:[l.includes("course")&&e.jsx(v,{value:"course",children:"Kelas Online"}),l.includes("bootcamp")&&e.jsx(v,{value:"bootcamp",children:"Bootcamp"}),l.includes("webinar")&&e.jsx(v,{value:"webinar",children:"Webinar"})]})]})]}),e.jsx("div",{className:"max-h-40 space-y-2 overflow-y-auto",children:E.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:o==="course"?"Tidak ada kelas yang tersedia":`Tidak ada ${L(o).toLowerCase()} yang tersedia untuk tanggal diskon ini`}):E.map(a=>{const s=re(a,o);return e.jsx("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-2 hover:bg-gray-50",onClick:()=>se(a,o),children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:a.title}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Rp ",new Intl.NumberFormat("id-ID").format(a.price)]}),(o==="bootcamp"||o==="webinar")&&a.batch&&e.jsxs("p",{className:"text-xs font-medium text-blue-600",children:["Batch ",a.batch]}),s&&e.jsx("p",{className:`mt-1 text-xs ${s.type==="closed"?"text-red-600":s.type==="will-close"?"text-orange-600":"text-green-600"}`,children:s.text})]})},a.id)})})]})})]})]}),x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Produk yang dipilih:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((a,s)=>e.jsxs(oe,{variant:"secondary",className:"flex items-center gap-2",children:[e.jsxs("span",{children:[L(a.type),": ",a.title]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>te(a),children:e.jsx(ye,{className:"h-3 w-3"})})]},s))})]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Kosong = berlaku untuk semua produk dari jenis yang dipilih"})]}),e.jsx(c,{control:r.control,name:"is_active",render:({field:a})=>e.jsxs(d,{className:"flex flex-row items-start space-y-0 space-x-3",children:[e.jsx(m,{children:e.jsx(w,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(n,{children:"Kode diskon aktif"}),e.jsx(j,{children:"Centang untuk mengaktifkan kode diskon"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(b,{type:"submit",className:"hover:cursor-pointer",children:"Simpan Kode Diskon"})})]})})]})]})}export{Ma as default};
