import{r as c,j as e,L as se,S as re}from"./app-CYILbaoi.js";import{B as ie}from"./badge-DGbrXFT9.js";import{B as u}from"./button-CLlJLTlY.js";import{a as ne,C as le}from"./calendar-BZq6qPrg.js";import{C as oe,a as de,b as me,c as ce,d as ue,e as pe}from"./command-BNan8g_s.js";import{u as he,i as xe,F as ge,a as p,b as h,c as x,d as be,e as d,f as w}from"./form-B6atDpSa.js";import{I as S}from"./input-oXmwVgH7.js";import{L as je}from"./label-CBpEaKXy.js";import{P as G,a as H,b as A}from"./popover-lImYfTEl.js";import{T as R}from"./textarea-OFhD6pZ0.js";import{A as fe}from"./admin-layout-BjzJrLRA.js";import{r as f,p as ve,c as Ne}from"./utils-D70Tm4tr.js";import{s as ye,o as U,c as ke,n as J,b as o,a as we}from"./types-DIvtpE3M.js";import{E as Se}from"./Editor-BPkE0xhe.js";import{t as I}from"./index-cBsCYfZr.js";import{P as T}from"./package-BujP0vd5.js";import{P as De}from"./plus-CYKYYYBB.js";import{G as Ce}from"./grip-vertical-DRM6QwiO.js";import{X as Pe}from"./x-CztZCKWT.js";import{C as Ie}from"./chevron-down-BmUU8g9g.js";import{s as Te,a as _e,b as Be}from"./setSeconds-Bils3bgI.js";import"./index-DMiO1qAw.js";import"./index-Dmf8IhCC.js";import"./format-CNjBDjOL.js";import"./chevron-left-BbtqFm9P.js";import"./createLucideIcon-GsIBX49w.js";import"./chevron-right-CqJIwGCr.js";import"./index-WgeQRLOk.js";import"./index-3tGqSjMC.js";import"./Combination-j_brszW9.js";import"./index-DQ7lSK2h.js";import"./index-BbAmjduH.js";import"./index-BkgLKw5P.js";import"./index-BAlv0roY.js";import"./floating-ui.react-dom-0bYVS00x.js";import"./dialog-DxQVzYhC.js";import"./search-JXoM8PXj.js";import"./sonner-CLUI3nWH.js";import"./breadcrumbs-CJXnIlNK.js";import"./tooltip-CDEoEIuX.js";import"./index-FVdKASAH.js";import"./index-CKqWFvSI.js";import"./dropdown-menu-BWgy41d2.js";import"./index-DGU35iqQ.js";import"./check-CRunFCf6.js";import"./avatar-D4dYc5Sq.js";import"./use-initials-C2FFciVR.js";import"./user-DXETfz_d.js";import"./app-sidebar-header-BVO0BQeh.js";import"./chevrons-up-down-LV_RtKod.js";import"./user-check-CE2LL8NY.js";import"./users-D_gNsYha.js";import"./presentation-DJRnJVlR.js";import"./gift-mpdk4TWt.js";import"./banknote-IH4cxJsn.js";import"./dollar-sign-BDlGQpeo.js";import"./file-text-KF7Ya-NO.js";import"./index-BljQCQMj.js";const Fe=r=>[{title:"Paket Bundling",href:route("bundles.index")},{title:r.title,href:route("bundles.show",r.id)},{title:"Edit Paket Bundling",href:route("bundles.edit",r.id)}],Ee=U({title:o().nonempty("Judul harus diisi"),short_description:o().nullable(),description:o().nullable(),benefits:o().nullable(),thumbnail:we().nullable(),registration_deadline:o().nonempty("Deadline pendaftaran harus diisi"),price:J().min(0,"Harga tidak boleh negatif"),items:ke(U({type:o(),id:o(),title:o(),price:J(),registration_deadline:o().nullable().optional()})).min(2,"Minimal 2 item harus dipilih")}).refine(r=>r.items.some(g=>g.price>0),{message:"Minimal harus ada 1 produk berbayar dalam bundle",path:["items"]}).refine(r=>{const b=r.items.reduce((g,v)=>g+v.price,0);return r.price<=b},{message:"Harga bundling tidak boleh melebihi total harga normal",path:["price"]});function Ga({bundle:r,courses:b,bootcamps:g,webinars:v}){var $;const[_,B]=c.useState(null),[K,D]=c.useState(!1),[V,F]=c.useState(!1),[W,E]=c.useState(!1),[j,C]=c.useState("course"),[z,N]=c.useState(!1),Y=(a,t)=>{const n=(a==="course"?b:a==="bootcamp"?g:v).find(l=>l.id===t);return(n==null?void 0:n.registration_deadline)||null},q=r.bundle_items.filter(a=>a.bundleable!==null).map(a=>{var s;let t="course";return a.bundleable_type.includes("Bootcamp")?t="bootcamp":a.bundleable_type.includes("Webinar")&&(t="webinar"),{type:t,id:a.bundleable_id,title:((s=a.bundleable)==null?void 0:s.title)||"Unknown",price:a.price,registration_deadline:Y(t,a.bundleable_id)}});let m=ne(new Date,7);m=Te(m,23),m=_e(m,59),m=Be(m,0);const i=he({resolver:ye(Ee),defaultValues:{title:r.title??"",short_description:r.short_description??"",description:r.description??"",benefits:r.benefits??"",thumbnail:null,registration_deadline:r.registration_deadline??m.toISOString(),price:r.price??0,items:q}}),y=i.watch("items"),{fields:P,append:X,remove:Q}=xe({control:i.control,name:"items"});c.useEffect(()=>{if(y.length===0)return;const a=new Date,t=y.filter(s=>s.registration_deadline).map(s=>new Date(s.registration_deadline)).filter(s=>s>a);if(t.length>0){const s=t.reduce((n,l)=>l<n?l:n);i.setValue("registration_deadline",s.toISOString()),N(!0)}else N(!1)},[y,i]);const Z=a=>{switch(a){case"course":return b||[];case"bootcamp":return g||[];case"webinar":return v||[];default:return[]}},M=(a,t)=>y.some(s=>s.type===a&&s.id===t),k=a=>Z(a).filter(s=>!M(a,s.id)),L=()=>P.reduce((a,t)=>a+(t.price||0),0),ee=(a,t)=>{if(M(a,t.id)){I.error("Item sudah ditambahkan");return}X({type:a,id:t.id,title:t.title,price:t.price,registration_deadline:t.registration_deadline||null}),E(!1)};function ae(a){const t={...a,_method:"PUT"};re.post(route("bundles.update",r.id),t,{forceFormData:!0})}return e.jsxs(fe,{breadcrumbs:Fe(r),children:[e.jsx(se,{title:`Edit Paket Bundling - ${r.title}`}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Edit ",r.title]}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:"Edit informasi paket bundling. Perubahan akan meng-update slug dan URL jika judul berubah."}),e.jsx(ge,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(ae),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Bundle"})]}),e.jsx(p,{control:i.control,name:"title",render:({field:a})=>e.jsxs(h,{children:[e.jsxs(x,{children:["Judul Bundling ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(be,{children:e.jsx(S,{placeholder:"Masukkan judul bundling",...a,autoComplete:"off"})}),e.jsx(d,{})]})}),e.jsx(p,{control:i.control,name:"short_description",render:({field:a})=>e.jsxs(h,{children:[e.jsx(x,{children:"Deskripsi Singkat"}),e.jsx(R,{...a,value:a.value??"",placeholder:"Deskripsi singkat bundle (maks 500 karakter)",maxLength:500,autoComplete:"off"}),e.jsx(d,{})]})}),e.jsx(p,{control:i.control,name:"description",render:({field:a})=>e.jsxs(h,{children:[e.jsx(x,{children:"Deskripsi Lengkap"}),e.jsx(R,{...a,value:a.value??"",placeholder:"Deskripsi lengkap bundle",rows:6,autoComplete:"off"}),e.jsx(d,{})]})}),e.jsx(p,{control:i.control,name:"benefits",render:({field:a})=>e.jsxs(h,{children:[e.jsx(x,{children:"Benefit Bundling"}),e.jsx(Se,{apiKey:"c7quf44sjov5dzvyzvgh4sryhheoi9t6vikfbzqk61pzpi77",value:a.value??"",onEditorChange:t=>a.onChange(t),init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",height:300,menubar:!1}}),e.jsx(w,{children:"Keuntungan yang didapat dari bundle ini"}),e.jsx(d,{})]})}),e.jsx(p,{control:i.control,name:"thumbnail",render:({field:a})=>e.jsxs(h,{children:[e.jsx(x,{children:"Thumbnail"}),e.jsx("img",{src:_||(r.thumbnail?`/storage/${r.thumbnail}`:"/assets/images/placeholder.png"),alt:r.title,className:"my-1 mt-2 h-40 rounded border object-cover"}),e.jsx(S,{type:"file",name:a.name,accept:"image/png, image/jpeg, image/jpg, image/webp",className:K?"border-red-500 focus-visible:ring-red-500":"",onChange:t=>{var n;const s=((n=t.target.files)==null?void 0:n[0])??null;if(s){if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(s.type)){D(!0),I.error("Gambar harus png, jpg, jpeg, atau webp");return}if(s.size>2*1024*1024){D(!0),I.error("Ukuran file maksimal 2MB!");return}}if(D(!1),a.onChange(s),s){const l=new FileReader;l.onload=te=>{var O;return B((O=te.target)==null?void 0:O.result)},l.readAsDataURL(s)}else B(null)}}),e.jsx(w,{children:"Format: PNG, JPG, JPEG, WEBP. Maksimal 2MB"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{size:16}),e.jsx("h3",{className:"font-medium",children:"Isi Paket & Harga"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(je,{children:["Isi Paket ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{open:W,onOpenChange:E,children:[e.jsx(H,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",size:"sm",children:[e.jsx(De,{className:"mr-1 h-4 w-4"})," Tambah Item"]})}),e.jsx(A,{className:"w-[400px] p-0",align:"end",children:e.jsxs(oe,{children:[e.jsx("div",{className:"border-b p-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(u,{type:"button",variant:j==="course"?"default":"outline",size:"sm",onClick:()=>C("course"),className:"flex-1",children:["Course (",k("course").length,")"]}),e.jsxs(u,{type:"button",variant:j==="bootcamp"?"default":"outline",size:"sm",onClick:()=>C("bootcamp"),className:"flex-1",children:["Bootcamp (",k("bootcamp").length,")"]}),e.jsxs(u,{type:"button",variant:j==="webinar"?"default":"outline",size:"sm",onClick:()=>C("webinar"),className:"flex-1",children:["Webinar (",k("webinar").length,")"]})]})}),e.jsx(de,{placeholder:"Cari item...",className:"h-9"}),e.jsxs(me,{children:[e.jsx(ce,{children:"Tidak ada item tersedia."}),e.jsx(ue,{children:k(j).map(a=>e.jsx(pe,{value:a.title,onSelect:()=>ee(j,a),className:"cursor-pointer",children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx("span",{className:"flex-1 truncate",children:a.title}),e.jsx("span",{className:"text-muted-foreground text-xs font-medium whitespace-nowrap",children:f.format(a.price||0)})]})},a.id))})]})]})})]})]}),P.length===0?e.jsxs("div",{className:"rounded-lg border-2 border-dashed p-8 text-center",children:[e.jsx(T,{className:"text-muted-foreground mx-auto mb-2 h-12 w-12"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Belum ada item ditambahkan"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:"Minimal 2 item untuk membuat bundle"})]}):e.jsxs("div",{className:"space-y-2",children:[P.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border p-3",children:[e.jsx(Ce,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:a.title}),a.price===0&&e.jsx(ie,{className:"text-xs",children:"Gratis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground text-xs capitalize",children:a.type==="course"?"Kelas Online":a.type}),a.registration_deadline&&e.jsxs("p",{className:"text-xs text-blue-600",children:["• Deadline:"," ",new Date(a.registration_deadline).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})]})]})]}),e.jsx("span",{className:`text-sm font-medium whitespace-nowrap ${a.price===0?"text-green-600":""}`,children:a.price===0?"Gratis":f.format(a.price||0)}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0",onClick:()=>Q(t),children:e.jsx(Pe,{className:"h-4 w-4"})})]},a.id)),e.jsx("div",{className:"bg-muted rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Harga Normal:"}),e.jsx("span",{className:"text-base font-bold",children:f.format(L())})]})})]}),e.jsx(d,{children:($=i.formState.errors.items)==null?void 0:$.message})]}),e.jsx(p,{control:i.control,name:"price",render:({field:a})=>{const t=L(),s=a.value>t&&t>0;return e.jsxs(h,{children:[e.jsxs(x,{children:["Harga Bundling ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(S,{...a,type:"text",placeholder:"Masukkan harga bundling",value:f.format(a.value||0),onChange:n=>a.onChange(ve(n.target.value)),autoComplete:"off",className:s?"border-red-500 focus-visible:ring-red-500":""}),s&&e.jsxs("p",{className:"text-sm font-medium text-red-500",children:["⚠️ Harga bundling tidak boleh melebihi total harga normal (",f.format(t),")"]}),!s&&t>0&&a.value>0&&e.jsxs("p",{className:"text-sm text-green-600",children:["✓ Hemat ",Math.round((t-a.value)/t*100),"% dari harga normal"]}),e.jsx(w,{children:"Harga spesial untuk bundling ini (harus lebih murah dari total harga normal)"}),e.jsx(d,{})]})}}),e.jsx(p,{control:i.control,name:"registration_deadline",render:({field:a})=>e.jsxs(h,{className:"flex flex-col",children:[e.jsxs(x,{children:["Deadline Pendaftaran ",e.jsx("span",{className:"text-red-500",children:"*"})]}),z&&e.jsx("div",{className:"mb-2 rounded-md bg-blue-50 p-2 text-xs text-blue-700",children:"ⓘ Deadline otomatis disesuaikan dengan produk terdekat yang dipilih"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs(G,{open:V,onOpenChange:F,children:[e.jsx(H,{asChild:!0,children:e.jsxs(u,{variant:"outline",id:"date",className:"w-32 justify-between font-normal",type:"button",children:[a.value?new Date(a.value).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}):"Pilih tanggal",e.jsx(Ie,{})]})}),e.jsx(A,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx(le,{mode:"single",selected:a.value?new Date(a.value):void 0,captionLayout:"dropdown",endMonth:new Date(new Date().getFullYear()+10,11),onSelect:t=>{const n=(a.value?new Date(a.value):new Date).toTimeString().split(" ")[0],l=t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:"";a.onChange(l&&n?`${l}T${n}`:""),F(!1),N(!1)}})})]})}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsx(S,{type:"time",id:"time",step:"60",value:a.value?new Date(a.value).toTimeString().slice(0,5):"23:59",onChange:t=>{const s=a.value?new Date(a.value):new Date,n=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`,l=t.target.value||"00:00";a.onChange(`${n}T${l}:00`),N(!1)},className:"bg-background appearance-none [&::-webkit-calendar-picker-indicator]:hidden [&::-webkit-calendar-picker-indicator]:appearance-none"})})]}),e.jsx(w,{children:z?"Deadline otomatis dari produk terdekat. Bisa diubah manual.":"Tanggal dan waktu terakhir untuk membeli bundle"}),e.jsx(d,{})]})}),e.jsxs("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-4",children:[e.jsx("h4",{className:"mb-2 font-medium text-gray-900",children:"Status Bundling"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsx("div",{className:Ne("w-fit rounded-full border px-3 py-1",r.status==="draft"&&"border-gray-200 bg-gray-100 text-gray-700",r.status==="published"&&"border-green-200 bg-green-100 text-green-700",r.status==="archived"&&"border-red-200 bg-red-100 text-red-700"),children:e.jsxs("span",{className:"font-medium capitalize",children:[r.status==="draft"&&"Draft",r.status==="published"&&"Published",r.status==="archived"&&"Archived"]})}),e.jsx("p",{className:"text-muted-foreground pt-2 text-xs",children:"Ubah status bundling di halaman detail setelah menyimpan perubahan."})]})]})]}),e.jsx(u,{type:"submit",className:"hover:cursor-pointer lg:col-span-2",disabled:i.formState.isSubmitting,children:i.formState.isSubmitting?"Menyimpan...":"Simpan Perubahan"})]})})]})]})}export{Ga as default};
