import{K as E,r as g,j as e,L as f,$ as j}from"./app-DbpzdwFL.js";import{B as R}from"./badge-DhvWYlS3.js";import{B as i}from"./button-nsSqORs2.js";import{C as U}from"./checkbox-qbAzKmG-.js";import{L as H}from"./label-CJg2QrTt.js";import{S as o}from"./separator-DjZCV5-r.js";import{U as k}from"./user-layout-BGVxSrPd.js";import{r as n}from"./utils-t30SwFLs.js";import{U as A}from"./user-CtC4W_DT.js";import{P as K}from"./package-BF1g8edw.js";import{B}from"./badge-check-CZ8-4okF.js";import{C as x}from"./check-BUnQtbm6.js";import{H as $}from"./hourglass-BNQVoG82.js";/* empty css            */import"./index-muyUwSbg.js";import"./index-BKZ60sTg.js";import"./index-Czgf-KsJ.js";import"./index-BNGjsBO4.js";import"./index-BrWH3fgz.js";import"./index-BBYaHc3j.js";import"./floating-ui.react-dom-GTqUnYaj.js";import"./index-BlfYzGKu.js";import"./index-DQnLm8Kj.js";import"./sonner-BVDcOtMc.js";import"./index-adnqAMSx.js";import"./breadcrumbs-BB8Ncwy_.js";import"./createLucideIcon-C4hA1fDf.js";import"./index-DLFvmWB3.js";import"./Combination-BfBk5v_5.js";import"./x-Ck5JSsba.js";import"./tooltip-BP3-rQs1.js";import"./index-BG9WF58p.js";import"./dropdown-menu-2YdbIEK2.js";import"./index-DWIaYFCs.js";import"./avatar-COyTLtDN.js";import"./use-initials-QSx-oft4.js";import"./chevron-right-B5kzfHcg.js";import"./icon-DkYG_jat.js";import"./chevron-down-qOg5Thj1.js";import"./popover-ByDDj6AP.js";import"./command-Dld5evAu.js";import"./dialog-CupH4Hmp.js";import"./search-Bb5VI_Ga.js";import"./circle-check-big-BY52VMjX.js";import"./clock-JumJjszk.js";import"./monitor-play-BpYKtXm7.js";import"./presentation-CbszFwHd.js";import"./house-CctVEg_T.js";import"./file-text-CQepP0w_.js";function Re({bundle:t,hasAccess:L,pendingInvoiceUrl:b,referralInfo:r}){var S;const{auth:y}=E().props,N=!!y.user,w=N&&((S=y.user)==null?void 0:S.phone_number),[d,F]=g.useState(!1),[v,P]=g.useState(!1),h=5e3,p=t.strikethrough_price-t.price,C=t.price+h;g.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("ref");s?sessionStorage.setItem("referral_code",s):r.code&&sessionStorage.setItem("referral_code",r.code)},[r]);const T=async()=>{try{const s=await(await fetch("/csrf-token",{method:"GET",credentials:"same-origin"})).json(),l=document.querySelector('meta[name="csrf-token"]');return l&&(l.content=s.token),s.token}catch(a){throw console.error("Failed to refresh CSRF token:",a),a}},D=async a=>{if(a.preventDefault(),!w){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!d){alert("Anda harus menyetujui syarat dan ketentuan!");return}P(!0);const s=async(l=0)=>{var _;const z={bundle_id:t.id,discount_amount:p,nett_amount:t.price,transaction_fee:h,total_amount:C};try{const c=(_=document.querySelector('meta[name="csrf-token"]'))==null?void 0:_.content,u=await fetch(route("invoice.store.bundle"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":c||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(z)});if(u.status===419&&l<2)return console.log(`CSRF token expired, refreshing... (attempt ${l+1})`),await T(),s(l+1);const m=await u.json();if(u.ok&&m.success)if(m.payment_url)window.location.href=m.payment_url;else throw new Error("Payment URL not received");else throw new Error(m.message||"Gagal membuat invoice.")}catch(c){throw console.error("Payment error:",c),c}};try{await s()}catch(l){alert(l.message||"Terjadi kesalahan saat proses pembayaran."),P(!1)}};if(!N){const a=window.location.href,s=route("login",{redirect:a});return e.jsxs(k,{children:[e.jsx(f,{title:"Login Required"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Paket Bundling "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan login terlebih dahulu untuk membeli paket bundling."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(A,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk membeli paket bundling ini.",r.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(i,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:s,children:"Login"})}),e.jsx(i,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(j,{href:route("register",r.code?{ref:r.code}:{}),children:"Daftar"})})]})]})})]})}return w?e.jsxs(k,{children:[e.jsx(f,{title:`Checkout - ${t.title}`}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsx("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:"Checkout Paket Bundling"}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan selesaikan pembayaran untuk mendapatkan akses ke semua program dalam paket bundling."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"rounded-lg border bg-white p-6 dark:bg-gray-800",children:[e.jsxs("div",{className:"mb-6 flex items-start gap-4",children:[e.jsx("img",{src:t.thumbnail?`/storage/${t.thumbnail}`:"/assets/images/placeholder.png",alt:t.title,className:"h-32 w-48 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(R,{className:"bg-primary mb-2 text-white",children:[e.jsx(K,{size:12,className:"mr-1"}),"Paket Bundling"]}),e.jsx("h2",{className:"mb-2 text-2xl font-bold text-gray-900 italic dark:text-white",children:t.title}),t.short_description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.short_description})]})]}),e.jsx(o,{className:"my-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-4 text-lg font-semibold text-gray-900 dark:text-white",children:["Isi Paket (",t.bundle_items_count," Program)"]}),e.jsx("div",{className:"space-y-3",children:t.bundle_items.map((a,s)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border p-3",children:[e.jsx("div",{className:"bg-primary/10 text-primary flex h-10 w-10 items-center justify-center rounded-full font-semibold",children:s+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-medium text-gray-900 dark:text-white",children:a.bundleable.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.bundleable_type.includes("Course")?"Kelas Online":a.bundleable_type.includes("Bootcamp")?"Bootcamp":"Webinar"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:a.price===0?"Gratis":n.format(a.price)})]},a.id))})]}),e.jsx(o,{className:"my-6"}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-4 dark:bg-green-900/20",children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 font-semibold text-green-800 dark:text-green-400",children:[e.jsx(B,{size:18}),"Keuntungan Paket Bundling"]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(x,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:["Hemat ",Math.round((t.strikethrough_price-t.price)/t.strikethrough_price*100),"% dari harga normal"]})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(x,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:["Akses ke ",t.bundle_items_count," program pembelajaran sekaligus"]})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(x,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Sertifikat untuk semua program yang diselesaikan"})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-green-700 dark:text-green-300",children:[e.jsx(x,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Akses selamanya ke semua materi pembelajaran"})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:L?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(B,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah membeli paket bundling ini. Silakan lanjutkan belajar."}),e.jsx(i,{asChild:!0,className:"w-full",children:e.jsx(j,{href:route("profile.index"),children:"Lihat Dashboard"})})]}):b?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx($,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk paket bundling ini. Silakan lanjutkan untuk membayar."}),e.jsx(i,{asChild:!0,className:"w-full",children:e.jsx("a",{href:b,children:"Lanjutkan Pembayaran"})})]}):e.jsxs("form",{onSubmit:D,children:[e.jsx("h2",{className:"mb-4 text-xl font-bold italic",children:"Detail Pembayaran"}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Harga Normal"}),e.jsx("span",{className:"text-sm font-semibold text-gray-500 line-through dark:text-gray-400",children:n.format(t.strikethrough_price)})]}),p>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Diskon Bundle"}),e.jsxs("span",{className:"text-sm font-semibold text-red-500",children:["-",n.format(p)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Harga Bundle"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:n.format(t.price)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Biaya Transaksi"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:n.format(h)})]}),e.jsx(o,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Total Pembayaran"}),e.jsx("span",{className:"text-primary text-2xl font-bold",children:n.format(C)})]})]}),e.jsx(o,{}),r.hasActive&&e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-800 dark:bg-blue-900/20",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-400",children:["ðŸŽ Menggunakan kode referral: ",e.jsx("span",{className:"font-bold",children:r.code})]}),e.jsx("p",{className:"mt-1 text-xs text-blue-600 dark:text-blue-500",children:"Anda membantu teman Anda mendapatkan komisi!"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{id:"terms",checked:d,onCheckedChange:a=>F(a===!0)}),e.jsxs(H,{htmlFor:"terms",className:"text-sm leading-tight",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(i,{className:"w-full",type:"submit",disabled:!d||v,children:v?"Memproses...":"Lanjutkan Pembayaran"})]})]})})]})})]}):e.jsxs(k,{children:[e.jsx(f,{title:"Checkout Paket Bundling"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Paket Bundling "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(A,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk membeli paket bundling."}),e.jsx(i,{asChild:!0,className:"w-full max-w-md",children:e.jsx(j,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{Re as default};
