import{r as x,j as e,L as oe,S as ce}from"./app-DbpzdwFL.js";import{B as de}from"./badge-DhvWYlS3.js";import{B as b}from"./button-nsSqORs2.js";import{C as $}from"./calendar-dbwpQUAb.js";import{C}from"./checkbox-qbAzKmG-.js";import{u as me,F as pe,a as d,b as m,c as i,d as p,f as g,e as u}from"./form-B-HgXYV7.js";import{I as k}from"./input-GGR-33Of.js";import{P as D,a as M,b as A}from"./popover-ByDDj6AP.js";import{S as z,a as J,b as W,c as q,d as v}from"./select-D4Rt7mhW.js";import{T as ue}from"./textarea-1lTExOUA.js";import{A as he}from"./admin-layout-qkh5HjtB.js";import{c as X}from"./utils-t30SwFLs.js";import{s as xe,o as G,c as H,d as je,f as Q,n as y,e as ge,b as h}from"./types-CQtFLSY3.js";import{T as fe}from"./tag-RMdqfzQ0.js";import{S as be}from"./shuffle-TogvA2bi.js";import{P as ke}from"./percent-DF8ypJHf.js";import{C as Y}from"./calendar-40U364nB.js";import{C as Z}from"./chevron-down-qOg5Thj1.js";import{C as ye}from"./circle-alert-SXM3LWrw.js";import{P as _e}from"./plus-AfvHX6ks.js";import{X as ve}from"./x-Ck5JSsba.js";import{p as K}from"./parseISO-CfmKIOEe.js";import{f as F}from"./format-CNjBDjOL.js";import{i as O}from"./id-BLKIQCr7.js";/* empty css            */import"./index-muyUwSbg.js";import"./index-BKZ60sTg.js";import"./chevron-left-69uj4ldC.js";import"./createLucideIcon-C4hA1fDf.js";import"./chevron-right-B5kzfHcg.js";import"./index-Czgf-KsJ.js";import"./index-BNGjsBO4.js";import"./index-BrWH3fgz.js";import"./index-BBYaHc3j.js";import"./floating-ui.react-dom-GTqUnYaj.js";import"./index-BlfYzGKu.js";import"./index-DQnLm8Kj.js";import"./check-BUnQtbm6.js";import"./label-CJg2QrTt.js";import"./Combination-BfBk5v_5.js";import"./index-DWIaYFCs.js";import"./index-BG9WF58p.js";import"./chevron-up-C65NXe2c.js";import"./sonner-BVDcOtMc.js";import"./index-adnqAMSx.js";import"./breadcrumbs-BB8Ncwy_.js";import"./index-DLFvmWB3.js";import"./tooltip-BP3-rQs1.js";import"./dropdown-menu-2YdbIEK2.js";import"./avatar-COyTLtDN.js";import"./use-initials-QSx-oft4.js";import"./user-CtC4W_DT.js";import"./app-sidebar-header-DlOmqqkD.js";import"./chevrons-up-down-DYhEesso.js";import"./user-check-lA5eDnOn.js";import"./users-ddkDeduW.js";import"./monitor-play-BpYKtXm7.js";import"./presentation-CbszFwHd.js";import"./gift-IIy9kaeP.js";import"./banknote-BtaNyBNx.js";import"./dollar-sign-CTBJ4doy.js";import"./file-text-CQepP0w_.js";const Ne=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Kode Diskon",href:"/admin/discount-codes"},{title:"Edit Kode Diskon",href:"#"}],we=G({code:h().min(1,"Kode diskon harus diisi").max(50,"Kode diskon maksimal 50 karakter"),name:h().min(1,"Nama diskon harus diisi").max(255,"Nama diskon maksimal 255 karakter"),description:h().optional(),type:ge(["percentage","fixed"],{required_error:"Jenis diskon harus dipilih"}),value:y().min(1,"Nilai diskon harus lebih dari 0"),minimum_amount:y().optional(),usage_limit:y().optional(),usage_limit_per_user:y().optional(),starts_at:Q({required_error:"Tanggal mulai harus dipilih"}),expires_at:Q({required_error:"Tanggal berakhir harus dipilih"}),is_active:je(),applicable_types:H(h()).optional(),applicable_products:H(G({type:h(),id:h(),title:h(),price:y(),registration_deadline:h().nullable().optional(),start_date:h().nullable().optional(),event_date:h().nullable().optional(),batch:y().nullable().optional()})).optional()}).refine(n=>!(n.type==="percentage"&&n.value>100),{message:"Persentase tidak boleh lebih dari 100%",path:["value"]}).refine(n=>n.expires_at>n.starts_at,{message:"Tanggal berakhir harus setelah tanggal mulai",path:["expires_at"]});function Fa({discountCode:n,products:N}){const[ee,B]=x.useState(!1),[ae,I]=x.useState(!1),[se,E]=x.useState(!1),[o,w]=x.useState("course"),r=me({resolver:xe(we),defaultValues:{code:n.code,name:n.name,description:n.description||"",type:n.type,value:n.value,minimum_amount:n.minimum_amount||void 0,usage_limit:n.usage_limit||void 0,usage_limit_per_user:n.usage_limit_per_user||void 0,starts_at:new Date(n.starts_at),expires_at:new Date(n.expires_at),is_active:n.is_active,applicable_types:n.applicable_types||[],applicable_products:n.applicable_products||[]}}),P=r.watch("type"),V=r.watch("applicable_types"),l=x.useMemo(()=>V||[],[V]),L=r.watch("applicable_products"),j=x.useMemo(()=>L||[],[L]),S=r.watch("starts_at");x.useEffect(()=>{if(l.length>0){const a=l[0];l.includes(o)||w(a)}},[l,o]);const te=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let s="";for(let t=0;t<8;t++)s+=a.charAt(Math.floor(Math.random()*a.length));r.setValue("code",s)},T=(a,s)=>{const t=l;if(s){const c=[...t,a];r.setValue("applicable_types",c),c.length===1&&w(a)}else{const c=t.filter(f=>f!==a);r.setValue("applicable_types",c);const _=j.filter(f=>f.type!==a);r.setValue("applicable_products",_),o===a&&c.length>0&&w(c[0])}},re=(a,s)=>{const t={...a,type:s,registration_deadline:a.registration_deadline||null,start_date:a.start_date||null,event_date:a.event_date||null,batch:a.batch||null},c=j;c.some(f=>f.id===a.id&&f.type===s)||r.setValue("applicable_products",[...c,t]),E(!1)},ne=a=>{const s=j.filter(t=>!(t.id===a.id&&t.type===a.type));r.setValue("applicable_products",s)},U=x.useMemo(()=>{const a=S,s=j.filter(t=>t.type===o).map(t=>t.id);switch(o){case"course":return N.courses.filter(t=>!s.includes(t.id));case"bootcamp":return N.bootcamps.filter(t=>s.includes(t.id)?!1:!t.registration_deadline||!a?!0:K(t.registration_deadline)>=a);case"webinar":return N.webinars.filter(t=>s.includes(t.id)?!1:!t.registration_deadline||!a?!0:K(t.registration_deadline)>=a);default:return[]}},[o,N,S,j]),R=a=>{switch(a){case"course":return"Kelas";case"bootcamp":return"Bootcamp";case"webinar":return"Webinar";default:return a}},ie=(a,s)=>{if(s==="course"||!a.registration_deadline)return null;const t=K(a.registration_deadline),c=new Date,_=S;return t<c?{type:"closed",text:"Pendaftaran ditutup"}:_&&t<_?{type:"will-close",text:"Akan tutup sebelum diskon aktif"}:{type:"open",text:`Tutup: ${F(t,"dd MMM yyyy",{locale:O})}`}};function le(a){const s={...a,description:a.description||null,minimum_amount:a.minimum_amount||null,usage_limit:a.usage_limit||null,usage_limit_per_user:a.usage_limit_per_user||null,applicable_types:a.applicable_types&&a.applicable_types.length>0?a.applicable_types:null,applicable_products:a.applicable_products&&a.applicable_products.length>0?a.applicable_products:null,starts_at:a.starts_at.toISOString(),expires_at:a.expires_at.toISOString(),_method:"PUT"};ce.post(route("discount-codes.update",n.id),s)}return e.jsxs(he,{breadcrumbs:Ne,children:[e.jsx(oe,{title:`Edit Kode Diskon - ${n.name}`}),e.jsxs("div",{className:"px-4 py-4 md:px-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Kode Diskon"}),e.jsxs("p",{className:"text-muted-foreground mb-6 max-w-2xl text-sm",children:['Ubah pengaturan kode diskon "',n.name,'". Pastikan semua informasi yang diperlukan telah diisi dengan benar.']}),e.jsx(pe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(le),className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:16}),e.jsx("h3",{className:"font-medium",children:"Informasi Dasar"})]}),e.jsx(d,{control:r.control,name:"code",render:({field:a})=>e.jsxs(m,{children:[e.jsxs(i,{children:["Kode Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{children:e.jsx(k,{placeholder:"DISKON2024",...a,onChange:s=>a.onChange(s.target.value.toUpperCase()),className:"font-mono",autoComplete:"off"})}),e.jsx(b,{type:"button",variant:"outline",onClick:te,children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsx(g,{children:"Kode unik untuk diskon ini (akan otomatis menjadi huruf besar)"}),e.jsx(u,{})]})}),e.jsx(d,{control:r.control,name:"name",render:({field:a})=>e.jsxs(m,{children:[e.jsxs(i,{children:["Nama Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{children:e.jsx(k,{placeholder:"Diskon Tahun Baru",...a,autoComplete:"off"})}),e.jsx(u,{})]})}),e.jsx(d,{control:r.control,name:"description",render:({field:a})=>e.jsxs(m,{children:[e.jsx(i,{children:"Deskripsi"}),e.jsx(p,{children:e.jsx(ue,{placeholder:"Deskripsi kode diskon...",...a,value:a.value||"",autoComplete:"off",rows:3})}),e.jsx(u,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(d,{control:r.control,name:"type",render:({field:a})=>e.jsxs(m,{children:[e.jsxs(i,{children:["Jenis Diskon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(z,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(p,{children:e.jsx(J,{children:e.jsx(W,{placeholder:"Pilih jenis diskon"})})}),e.jsxs(q,{children:[e.jsx(v,{value:"percentage",children:"Persentase (%)"}),e.jsx(v,{value:"fixed",children:"Nominal (Rp)"})]})]}),e.jsx(u,{})]})}),e.jsx(d,{control:r.control,name:"value",render:({field:a})=>e.jsxs(m,{children:[e.jsxs(i,{children:["Nilai ",P==="percentage"?"Persentase":"Nominal"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{children:e.jsx(k,{type:"number",placeholder:P==="percentage"?"10":"50000",...a,onChange:s=>a.onChange(Number(s.target.value)),min:"1",max:P==="percentage"?100:void 0})}),e.jsx(g,{children:P==="percentage"?"Masukkan nilai 1-100":"Masukkan nominal dalam Rupiah"}),e.jsx(u,{})]})})]}),e.jsx(d,{control:r.control,name:"minimum_amount",render:({field:a})=>e.jsxs(m,{children:[e.jsx(i,{children:"Minimum Pembelian"}),e.jsx(p,{children:e.jsx(k,{type:"number",placeholder:"100000",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"0"})}),e.jsx(g,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"space-y-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{size:16}),e.jsx("h3",{className:"font-medium",children:"Penggunaan & Validitas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:r.control,name:"usage_limit",render:({field:a})=>e.jsxs(m,{children:[e.jsx(i,{children:"Batas Penggunaan Total"}),e.jsx(p,{children:e.jsx(k,{type:"number",placeholder:"100",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"1"})}),e.jsx(g,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})}),e.jsx(d,{control:r.control,name:"usage_limit_per_user",render:({field:a})=>e.jsxs(m,{children:[e.jsx(i,{children:"Batas Per User"}),e.jsx(p,{children:e.jsx(k,{type:"number",placeholder:"1",...a,onChange:s=>a.onChange(s.target.value?Number(s.target.value):void 0),value:a.value||"",min:"1"})}),e.jsx(g,{children:"Kosongkan untuk tidak membatasi"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:r.control,name:"starts_at",render:({field:a})=>e.jsxs(m,{className:"flex flex-col",children:[e.jsxs(i,{children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(D,{open:ee,onOpenChange:B,children:[e.jsx(M,{asChild:!0,children:e.jsx(p,{children:e.jsxs(b,{variant:"outline",className:X("justify-between text-left font-normal",!a.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),a.value?F(a.value,"dd MMM yyyy",{locale:O}):"Pilih tanggal"]}),e.jsx(Z,{className:"h-4 w-4"})]})})}),e.jsx(A,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx($,{mode:"single",selected:a.value,captionLayout:"dropdown",onSelect:s=>{s&&a.onChange(s),B(!1)},disabled:s=>s<new Date,initialFocus:!0})})]}),e.jsx(g,{children:"Produk bootcamp dan webinar akan difilter berdasarkan tanggal ini"}),e.jsx(u,{})]})}),e.jsx(d,{control:r.control,name:"expires_at",render:({field:a})=>e.jsxs(m,{className:"flex flex-col",children:[e.jsxs(i,{children:["Tanggal Berakhir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(D,{open:ae,onOpenChange:I,children:[e.jsx(M,{asChild:!0,children:e.jsx(p,{children:e.jsxs(b,{variant:"outline",className:X("justify-between text-left font-normal",!a.value&&"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),a.value?F(a.value,"dd MMM yyyy",{locale:O}):"Pilih tanggal"]}),e.jsx(Z,{className:"h-4 w-4"})]})})}),e.jsx(A,{className:"w-auto overflow-hidden p-0",align:"start",children:e.jsx($,{mode:"single",selected:a.value,captionLayout:"dropdown",onSelect:s=>{s&&a.onChange(s),I(!1)},disabled:s=>s<r.getValues("starts_at"),initialFocus:!0})})]}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Berlaku Untuk Produk"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"course",checked:l.includes("course"),onCheckedChange:a=>T("course",!!a)}),e.jsx(i,{htmlFor:"course",className:"text-sm font-normal",children:"Kelas Online"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"bootcamp",checked:l.includes("bootcamp"),onCheckedChange:a=>T("bootcamp",!!a)}),e.jsx(i,{htmlFor:"bootcamp",className:"text-sm font-normal",children:"Bootcamp"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:"webinar",checked:l.includes("webinar"),onCheckedChange:a=>T("webinar",!!a)}),e.jsx(i,{htmlFor:"webinar",className:"text-sm font-normal",children:"Webinar"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kosong = berlaku untuk semua produk"}),(l.includes("bootcamp")||l.includes("webinar"))&&e.jsx("div",{className:"rounded-md bg-blue-50 p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ye,{className:"mt-0.5 mr-2 h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-blue-800",children:"Catatan:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Bootcamp dan webinar yang dapat dipilih hanya yang pendaftarannya masih berlaku setelah tanggal mulai diskon."})]})]})})]}),l.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Produk Spesifik (Opsional)"}),e.jsxs(D,{open:se,onOpenChange:E,children:[e.jsx(M,{asChild:!0,children:e.jsxs(b,{type:"button",variant:"outline",size:"sm",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Tambah Produk"]})}),e.jsx(A,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Jenis Produk"}),e.jsxs(z,{value:o,onValueChange:w,children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Pilih jenis produk"})}),e.jsxs(q,{children:[l.includes("course")&&e.jsx(v,{value:"course",children:"Kelas Online"}),l.includes("bootcamp")&&e.jsx(v,{value:"bootcamp",children:"Bootcamp"}),l.includes("webinar")&&e.jsx(v,{value:"webinar",children:"Webinar"})]})]})]}),e.jsx("div",{className:"max-h-40 space-y-2 overflow-y-auto",children:U.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:o==="course"?"Tidak ada kelas yang tersedia atau semua sudah dipilih":`Tidak ada ${R(o).toLowerCase()} yang tersedia untuk tanggal diskon ini atau semua sudah dipilih`}):U.map(a=>{const s=ie(a,o);return e.jsx("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-2 hover:bg-gray-50",onClick:()=>re(a,o),children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:a.title}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Rp ",new Intl.NumberFormat("id-ID").format(a.price)]}),(o==="bootcamp"||o==="webinar")&&a.batch&&e.jsxs("p",{className:"text-xs font-medium text-blue-600",children:["Batch ",a.batch]}),s&&e.jsx("p",{className:`mt-1 text-xs ${s.type==="closed"?"text-red-600":s.type==="will-close"?"text-orange-600":"text-green-600"}`,children:s.text})]})},a.id)})})]})})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Produk yang dipilih:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((a,s)=>e.jsxs(de,{variant:"secondary",className:"flex items-center gap-2",children:[e.jsxs("span",{children:[R(a.type),": ",a.title]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 hover:bg-transparent",onClick:()=>ne(a),children:e.jsx(ve,{className:"h-3 w-3"})})]},s))})]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Kosong = berlaku untuk semua produk dari jenis yang dipilih"})]}),e.jsx(d,{control:r.control,name:"is_active",render:({field:a})=>e.jsxs(m,{className:"flex flex-row items-start space-y-0 space-x-3",children:[e.jsx(p,{children:e.jsx(C,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Kode diskon aktif"}),e.jsx(g,{children:"Centang untuk mengaktifkan kode diskon"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(b,{type:"submit",className:"hover:cursor-pointer",disabled:r.formState.isSubmitting,children:r.formState.isSubmitting?"Menyimpan...":"Simpan Perubahan"})})]})})]})]})}export{Fa as default};
